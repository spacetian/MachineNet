<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>销售记录明细（天）</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
			
			.oa-contact-cell.mui-table .mui-table-cell {
				padding: 11px 0;
				vertical-align: middle;
			}
			
			.oa-contact-cell {
				position: relative;
				margin: -11px 0;
			}
			
			.oa-contact-avatar {
				width: 75px;
			}
			
			.oa-contact-avatar img {
				border-radius: 5%;
			}
			
			.oa-contact-content {
				width: 100%;
			}
			
			.oa-contact-name {
				margin-right: 20px;
			}
			
			.oa-contact-name,
			oa-contact-position {
				float: left;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class=" mui-icon mui-icon-left-nav mui-pull-left" href="MyOrder.html"></a>
			<h1 class="mui-title">每天销售记录明细[<span id='result' class="ui-alert"></span>]</h1>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded">
				<button id='btnSelectDate' data-options='{"type":"date"}' class="btn mui-btn mui-btn-block">选择日期 ...</button>
			</div>

			<ul class="mui-table-view mui-table-view-striped mui-table-view-condensed" id="salesDiv">
				<!--<li class="mui-table-view-cell">
					<div class="mui-slider-cell">
						<div class="oa-contact-cell mui-table">
							<div class="oa-contact-avatar mui-table-cell">
								<img src="../images/60x60.gif" />
							</div>
							<div class="oa-contact-content mui-table-cell">
								<div class="mui-clearfix">
									<h4 class=" oa-contact-name">可口可乐</h4>
									<span class="oa-contact-position mui-h6">1.5元</span>
								</div>
								<p class="oa-contact-email mui-h6">
									售货机编号（XM216001)1
								</p>
							</div>
						</div>
					</div>
				</li>-->

			</ul>
			

		</div>
	</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/mui.picker.min.js"></script>
	<script type="text/javascript">
		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		mui.ready(function() {
			mui.plusReady(function() {
				var result = mui('#result')[0];
				var btns = mui('.btn');
				btns.each(function(i, btn) {
					btn.addEventListener('tap', function() {
						var optionsJson = this.getAttribute('data-options') || '{}';
						var options = JSON.parse(optionsJson);
						var id = this.getAttribute('id');
						/*
						 * 首次显示时实例化组件
						 * 示例为了简洁，将 options 放在了按钮的 dom 上
						 * 也可以直接通过代码声明 optinos 用于实例化 DtPicker
						 */
						var picker = new mui.DtPicker(options);
						picker.show(function(rs) {
							/*
							 * rs.value 拼合后的 value
							 * rs.text 拼合后的 text
							 * rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
							 * rs.m 月，用法同年
							 * rs.d 日，用法同年
							 * rs.h 时，用法同年
							 * rs.i 分（minutes 的第二个字母），用法同年
							 */
							result.innerText = ' ' + rs.text;

							/* 
							 * 返回 false 可以阻止选择框的关闭
							 * return false;
							 */
							/*
							 * 释放组件资源，释放后将将不能再操作组件
							 * 通常情况下，不需要示放组件，new DtPicker(options) 后，可以一直使用。
							 * 当前示例，因为内容较多，如不进行资原释放，在某些设备上会较慢。
							 * 所以每次用完便立即调用 dispose 进行释放，下次用时再创建新实例。
							 */
							picker.dispose();

							// 1 获取用户编号
							var userCode = localStorage.getItem("userCode");
							var orderTime = rs.text.replace("-","").replace("-","");
                            console.log("[userCode]" + userCode + "[orderTime]" + orderTime);
							GetOrderDetailsByDate(userCode, orderTime);  // 2 获取订单信息

						});
					}, false);
				});
			})

            // 2 获取订单信息
			function GetOrderDetailsByDate(userCode, orderTime) {
				var url = "http://home.shj8.top/api/App/Order/GetOrderListByDate";
				var jsonData = {
					userCode: userCode,
					orderTime: orderTime
				};
				mui.ajax(url, {
					data: jsonData,
					dataType: 'json',
					type: 'POST',
					timeout: 10000,
					success: function(data) {
						console.log("获取销售记录信息" + data);
						plus.nativeUI.closeWaiting();
						var list = document.getElementById("salesDiv");
                        list.innerHTML = "";
						var machineIndex = new Array();
			
						mui.each(data, function(index, item) {


							var li = document.createElement("li");
							li.className = "mui-table-view-cell";
							li.innerHTML = 
'					<div class="mui-slider-cell">										   '+
'						<div class="oa-contact-cell mui-table">							   '+
'							<div class="oa-contact-avatar mui-table-cell">				   '+
'								<img src="../images/60x60.gif"  style="height:120px;width:60px;"/>						   '+
'							</div>														   '+
'							<div class="oa-contact-content mui-table-cell">				   '+
'								<div class="mui-clearfix">								   '+
'									<h4 class="oa-contact-name">'+ item.PayAmount +' 元</h4> '+ 
                                   '<h3 style="float:right;">'+ GetNotNullVal(item.Subject) +'</h3> '+
'									<span class="oa-contact-position mui-h6"> ' + GetPayType(item.PayType) +  '支付</span>' +
'								</div>													   '+
'								<p class="oa-contact-email mui-h6">	[售货机编号]:'+ item.MachineCode  +'</p>'+
'								<p class="oa-contact-email mui-h6"> [货道编号]：'+ item.ChannelCode +'</p>'+
'								<p class="oa-contact-email mui-h6">	[付款状态]: '+ GetIsStatus(item.IsPayComplated) +'付款 </p>'+
'								<p class="oa-contact-email mui-h6">	[出货状态]：'+ GetIsOutStatus(item.IsFinishSale) +'</p>'+
'								<p class="oa-contact-email mui-h6">	[订单编号]：'+ item.PayNo+'</p>'+
'							</div>														   '+
'						</div>															   '+
'					</div>																   ';

							console.log(li);
					        list.appendChild(li);
						});

					},
					error: function(xhr, type, errorThrown) {
						console.log("post test button fail [xhr]:" + xhr + " [type]:" + type + " [errorThrown]:" + errorThrown);
						plus.nativeUI.toast("网络错误");

					}
				});

			}
		})
		
        function GetIsStatus(mObj) {
            if (mObj == null || mObj == false) {
                return "未";
            }
            else {
                return "已";
            }
        }
        
         function GetNotNullVal(mObj) {
            if (mObj == null ) {
                return "";
            }
            else {
                return mObj;
            }
        }

        function GetIsOutStatus(mObj) {
            if(mObj == null )
            {
                return "没有出货";
            }
            else {
                switch(mObj)
                {
                    case 1:
                        return "已经出货";
                        break;
                    case 2:
                        return "等待出货";
                        break;
                    case 3:
                        return "已通知完成付款"
                        break;
                    default:
                        return mObj;
                }
            }
        }

        function GetPayType(mObj)
        {
            if (mObj == null) {
                mObj = "";
            }
            else {
                switch(mObj)
                {
                    case "0":
                        mObj = "现金";
                        break;
                    case "1":
                        mObj = "IC卡";
                        break;
                    case "2":
                        mObj = "支付宝";
                        break;
                    case "3":
                        mObj = "微信";
                        break;
                    default:
                        return mObj;
                }
            }
            return mObj;
        }
	</script>

</html>